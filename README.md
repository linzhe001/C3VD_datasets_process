# C3VDRaycasting10K

## Background

C3VDRaycasting10K is a synthetic point cloud dataset derived from the original C3VD (Colonoscopy 3D Video Dataset) for training and evaluating point cloud registration methods in endoscopic scenes. This dataset addresses the challenge of obtaining ground-truth point cloud correspondences in real colonoscopy procedures by leveraging ray-casting techniques to generate paired source and target point clouds with known transformations.

The dataset generation pipeline uses depth maps and 3D mesh models from C3VD to create high-quality point cloud pairs suitable for learning-based registration tasks. Each pair consists of a source point cloud (synthesized from depth maps) and a target point cloud (visible surface points sampled from the mesh model via ray-casting), ensuring geometric consistency and realistic colonoscopy scene characteristics.

## Dataset Structure

The complete dataset requires the following folder structure. Please build the `datasets` folder and change `DATA_ROOT` to your folder path in each bash file:

```
├── datasets
│   ├── Original_C3VD
│   ├── C3VD_Raycasting10K_source
│   └── C3VD_Raycasting10K_target
```

### Original C3VD Dataset
**Folder name:** `Original_C3VD`

This folder contains the original C3VD dataset (needs to be prepared before running the pipeline). It stores:
- Depth maps (TIFF format)
- 3D mesh models (OBJ format)
- Camera pose files (TXT format)

Example structure:
```
├── Original_C3VD
│   └── cecum_t1_a
│       ├── 0000_depth.tiff
│       ├── coverage_mesh.obj
│       └── pose.txt
```

### C3VD Raycasting10K Source Point Clouds
**Folder name:** `C3VD_Raycasting10K_source`

This folder is automatically generated by `creat_check_pcd.py` and contains source point clouds synthesized from single-frame depth maps. These represent the point clouds that would be obtained from actual depth sensing in colonoscopy.

Files are named with the pattern `XXXX_s.ply` where `XXXX` is the frame number and `_s` indicates source point cloud.

Example structure:
```
├── C3VD_Raycasting10K_source
│   └── cecum_t1_a
│       ├── 0000_s.ply
│       ├── 0001_s.ply
│       └── ...
```

### C3VD Raycasting10K Target Point Clouds
**Folder name:** `C3VD_Raycasting10K_target`

This folder is automatically generated by `visible_point_cloud.sh` and contains target point clouds created by ray-casting the mesh model for each camera pose. These represent the ground-truth visible surface points and serve as registration targets during training.

Files are named with the pattern `XXXX_t.ply` where `XXXX` is the frame number and `_t` indicates target point cloud.

Example structure:
```
├── C3VD_Raycasting10K_target
│   └── cecum_t1_a
│       ├── 0000_t.ply
│       ├── 0001_t.ply
│       └── ...
```

## Pipeline of Data Generation

<!-- Add figure here: Figure 1 - Overview of the data generation pipeline -->
<!-- ![Pipeline Overview](figures/pipeline.png) -->

The complete pipeline consists of the following steps:

### Step 1: Source Point Cloud Generation
Run `creat_check_pcd.sh` to generate source point clouds from depth maps:

```bash
bash creat_check_pcd.sh
```

This script processes each depth map and camera pose to synthesize point clouds that simulate real sensor data.

<!-- Add figure here: Figure 2 - Source point cloud generation from depth maps -->
<!-- ![Source Generation](figures/source_generation.png) -->

### Step 2: Target Point Cloud Generation via Ray-Casting
Run `visible_point_cloud.sh` to generate target point clouds by sampling visible mesh surfaces:

```bash
bash visible_point_cloud.sh
```

This script performs ray-casting from each camera pose to the mesh model, sampling only the visible surface points to create ground-truth target point clouds.

<!-- Add figure here: Figure 3 - Target point cloud generation via ray-casting -->
<!-- ![Target Generation](figures/target_generation.png) -->

The above steps complete the process for generating the C3VDRaycasting10K paired point cloud dataset.

## Additional Scripts

### Point Cloud Merging (Optional)
**Script:** `create_merge.py`

This script can be used to merge multiple frames instead of using all frames individually. It creates multi-frame fused point clouds with corresponding metadata in JSON format.

**Generated folder:** `fused_C3VD_new` (optional, for multi-frame experiments)

Example structure:
```
├── fused_all_C3VD
│   └── cecum_t1_a
│       └── cecum_t1_a_merged_all.ply
```

### Outlier Detection
**Script:** `c3vd_outlier_checker.py`

This script provides quality control by detecting and filtering outliers in the generated point clouds.

## Acknowledgments

This dataset is built upon the [C3VD (Colonoscopy 3D Video Dataset)](https://durrlab.github.io/C3VD/), which provides the original depth maps, 3D models, and camera poses. We gratefully acknowledge the creators of C3VD for making their valuable data publicly available, enabling this research.


## Citation

If you use C3VDRaycasting10K in your research, please cite our paper:

```bibtex
@article{jiang2025mambanetlk,
  title={MambaNetLK: Enhancing Colonoscopy Point Cloud Registration with Mamba},
  author={Jiang, Linzhe and Huang, Jiayuan and Bano, Sophia and
          Clarkson, Matthew J and Mao, Zhehua and Hoque, Mobarak I},
  journal={arXiv preprint arXiv:2511.00260},
  year={2025}
}
```

**Original C3VD Citation:**
```bibtex
@article{bobrow2023,
  title={Colonoscopy 3D video dataset with paired depth from 2D-3D registration},
  author={Bobrow, Taylor L and Golhar, Mayank and Vijayan, Rohan and
          Akshintala, Venkata S and Garcia, Juan R and Durr, Nicholas J},
  journal={Medical Image Analysis},
  pages={102956},
  year={2023},
  publisher={Elsevier}
}
```


**Paper Link:** [arXiv:2511.00260](https://arxiv.org/abs/2511.00260)

## License
This dataset is licensed under [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)

